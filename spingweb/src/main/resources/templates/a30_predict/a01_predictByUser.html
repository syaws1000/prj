<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="/com/bootstrap.min.css" >
<style>
        .navbar .form-control {
            max-width: 200px;
        }
        .data-card {
            margin-bottom: 15px;
        }
        #sch1, #sch2{
        	width:100%;
        }
</style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    $(document).ready(function() {
        // ë“±ë¡ëœ ë°ì´í„°ë¥¼ ì €ì¥í•  ë°°ì—´
        const registeredData = {id:[],month:[]};

        // ğŸŸ¡ ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        $("#regBtn").on("click", function() {
            // ì•„ì´ë””ì™€ ê°œì›” ìˆ˜ë¥¼ ê°ê°ì˜ ì…ë ¥ í•„ë“œì—ì„œ ë…ë¦½ì ìœ¼ë¡œ ê°€ì ¸ì˜´
            const id = $("#regId").val().trim();
            const month = $("#regMonth").val().trim();

            if (id === '' && month === '') {
                alert('ì•„ì´ë”” ë˜ëŠ” ê°œì›” ìˆ˜ë¥¼  ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }else{
				if(id!==''){
					registeredData.id.push(id)
				}
				if(month!==''){
					registeredData.month.push(parseInt(month))
				}
				
            }

            // HTML ì¹´ë“œ í…œí”Œë¦¿ ìƒì„±
            const cardHtml1 = `
                <div class="col-md-4 data-card">
                    <div class="card bg-light">
                        <div class="card-body">
                            <span class="card-title">ì˜ˆì¸¡í•  ì•„ì´ë””: ${id}</span>
                            <button class="btn btn-sm btn-danger remove-btn">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `;
            // #schì— ì¹´ë“œ ì¶”ê°€
            if(id!=='')
            	$("#sch1").append(cardHtml1);            
            // HTML ì¹´ë“œ í…œí”Œë¦¿ ìƒì„±
            const cardHtml2 = `
                <div class="col-md-4 data-card">
                    <div class="card bg-light">
                        <div class="card-body">
                            <span class="card-text">ì˜ˆì¸¡ ê°œì›” ìˆ˜: ${month}</span>
                            <button class="btn btn-sm btn-danger remove-btn">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `;
            // #schì— ì¹´ë“œ ì¶”ê°€
            if(month!=='')
            	$("#sch2").append(cardHtml2);

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            $("#regId").val("");
            $("#regMonth").val("");
        });

        // ğŸŸ¡ ë™ì ìœ¼ë¡œ ìƒì„±ëœ ì‚­ì œ ë²„íŠ¼ì— ëŒ€í•œ ì´ë²¤íŠ¸ ìœ„ì„
        $("#sch").on("click", ".remove-btn", function() {
            const card = $(this).closest(".data-card");
            
            // ì¹´ë“œì—ì„œ ì•„ì´ë””ì™€ ê°œì›” ìˆ˜ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê°€ì ¸ì˜´
            const cardId = card.find(".card-title").text().replace("ì˜ˆì¸¡í•  ì•„ì´ë””: ", '');
            const cardMonth = card.find(".card-text").text().replace('ì˜ˆì¸¡ ê°œì›” ìˆ˜: ', '');
            
            console.log("## ì‚­ì œí•  id ##"+ cardId)
            console.log("## ì‚­ì œí•  ê°œì›”ìˆ˜ ##"+ cardMonth)
            
            // registeredData ë°°ì—´ì—ì„œ í•´ë‹¹ ë°ì´í„° ê°ì²´ ì œê±°
            const idIdx = registeredData.id.findIndex(item => item == cardId );
            console.log("## í˜„ì¬ ë“±ë¡ëœ  idì˜ indexë“¤ ##"+ registeredData.id)
            console.log("## ì‚­ì œí•  idì˜ index ##"+ idIdx)

            const mnIdx = registeredData.month.findIndex(item => item == cardMonth);
            console.log("## ì‚­ì œí•  ê°œì›”ìˆ˜  index##"+ mnIdx)
                        
            if (idIdx > -1) {
                registeredData.id.splice(idIdx, 1);
            }
            if (mnIdx > -1) {
                registeredData.month.splice(mnIdx, 1);
            }           
            
            // í™”ë©´ì—ì„œ ì¹´ë“œ ì œê±°
            card.remove();
        });

        // Search ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        $("#searchBtn").on("click", function() {
            const jsonData = JSON.stringify(registeredData, null, 2);
            console.log(jsonData);
            charJson('bar',registeredData, myBarChart)
            //alert('JSON ë°ì´í„°ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n' + jsonData);
        });
    });
</script>
    </script>

</head>

<body>
<div class="jumbotron text-center">
  <h2>ì°¨íŠ¸ ì¡°íšŒ</h2>
  <div class="container mt-4">
      <h5 class="mb-3">ì˜ˆì¸¡í•  ë°ì´í„°</h5>     
      <div id="sch" >
	      <div id="sch1" class="row"></div>
	      <div id="sch2" class="row"></div>
      </div>
  </div>
</div>
<div class="container">
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark p-3">
        <div class="container-fluid">
            <div class="d-flex flex-grow-1">
                <input placeholder="í™•ì¸í•  ì•„ì´ë””" id="regId" class="form-control me-2" type="text" />
                <input placeholder="ì˜ˆì¸¡í•  ê°œì›” ìˆ˜" id="regMonth" class="form-control me-2" type="number" />
                <button class="btn btn-success me-2" id="regBtn" type="button">ë“±ë¡</button>
                <button class="btn btn-info" id="searchBtn" type="button">Search</button>
            </div>
        </div>
    </nav>



	


              <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">Charts</h1>
                    <!-- Content Row -->
                    <div class="row">

                        <div class="col-xl-12 col-lg-12">

                            <!-- Area Chart 
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Area Chart</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                    <hr>
                                    Styling for the area chart can be found in the
                                    <code>/js/demo/chart-area-demo.js</code> file.
                                </div>
                            </div>
							-->
                            <!-- Bar Chart -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Bar Chart</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-bar">
                                        <canvas id="myBarChart"></canvas>
                                    </div>

                                </div>
                            </div>

                        </div>

                        <!-- Donut Chart 
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4">
                             
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Donut Chart</h6>
                                </div>

                                <div class="card-body">
                                    <div class="chart-pie pt-4">
                                        <canvas id="myPieChart"></canvas>
                                    </div>
                                    <hr>
                                    Styling for the donut chart can be found in the
                                    <code>/js/demo/chart-pie-demo.js</code> file.
                                </div>
                            </div>
                        </div>
                        -->
                    </div>

                </div>
            
                


    
</div>
   <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>



    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/chart-bar-demo.js"></script>
    <!--
    <script src="js/demo/chart-area-demo.js"></script>
     
    <script src="js/demo/chart-pie-demo.js"></script>
    
    
     -->   
    <script> 	
    //charJson('area',myLineChart)
    myBarChart.options.scales.yAxes[0].ticks.max=300
    charJson('bar',{'id':['1', '3', '5'], 'month':[1, 2, 6, 12]}, myBarChart)
    //charJson('pie',myPieChart)       
    // http://localhost:8888/predict

    function charJson(type, json,chartOb){
		console.log("##ìš”ì²­ ë°ì´í„°##")
		console.log(json)
        let mx =0
        let mi =999999999
        $.ajax({
    		url:"http://localhost:8888/predict",
    		//url:"chartJson",
    		//data:"type="+type,
    		type:"post",
            data: JSON.stringify(json), // 2. JavaScript ë°°ì—´ì„ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
            contentType: 'application/json; charset=utf-8', // 3. ë³´ë‚´ëŠ” ë°ì´í„°ê°€ JSON í˜•ì‹ì„ì„ ì„œë²„ì— ì•Œë¦¼
    		dataType:"json",
    		success:function(chart){
    			console.log("# ì°¨íŠ¸ ë°ì´í„° ë¡œë”© í›„ #")
    			console.log(chart)
    			let ids = []
    			console.log("# ì°¨íŠ¸ ë°ì´í„°ë§Œ #")
				console.log(chart.data)
				console.log("# ì°¨íŠ¸ ë°ì´í„°ë§Œ ###")
				let dataSet = []
    			
    			$.each(chart.data, function(idx, user){
    				//ids.push(user.shift())
    				
    				let us = {}
    				us.label = "id:"+user.shift()
    				us.data = user
    				let colors=[parseInt(Math.random()*255), parseInt(Math.random()*255),parseInt(Math.random()*255)]
    				us.backgroundColor =  'rgba('+colors[0]+', '+colors[1]+', '+colors[2]+', 0.5)'
    				dataSet.push(us)
        			//chartOb.data.datasets[idx].data = user
        			//chartOb.data.datasets[idx].backgroundColor = 'rgba('+(255-(idx*20))+', 99, 132, 0.5)'
    				const maxValue = Math.max(...user);
    				const minValue = Math.min(...user);     
    				if(mx<maxValue) mx = maxValue
    				if(mi>minValue) mi = minValue
    				
				})
				console.log("### ì…ë ¥ì „(datasets) ###")
				console.log(dataSet)
				chartOb.data.datasets = dataSet
    			chart.columns.shift()
    			chartOb.data.labels = chart.columns
    			chartOb.options.scales.yAxes[0].ticks.max=Math.ceil(mx/500000)*500000
    			
    			chartOb.options.scales.yAxes[0].ticks.min=Math.floor(mi/100000)*100000
    			
    			chartOb.update() // jsonë°ì´í„°ì—ì„œ ë°›ì€ ë‚´ìš©ìœ¼ë¡œ ì ìš©.. 
    		},
    		error:function(err){
    			console.log(err)
    		}
        })
	}	
	</script>

</body>